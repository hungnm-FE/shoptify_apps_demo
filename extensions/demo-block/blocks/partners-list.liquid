<div id="partners-block-{{ block.id }}"></div>

<script>
  (async () => {
    const containerId = "partners-block-{{ block.id }}";
    const el = document.getElementById(containerId);
    if (!el) return;

    const url = "https://shirt-marcus-potentially-shots.trycloudflare.com/api/partners";
    console.log("[Partners block] Fetching from", url);

    try {
      const res = await fetch(url, { credentials: "omit" });

      if (!res.ok) {
        console.error("[Partners block] HTTP error", res.status);
        el.innerText = "Không load được danh sách đối tác (HTTP " + res.status + ")";
        return;
      }

      const partners = await res.json();
      console.log("[Partners block] data =", partners);

      if (!Array.isArray(partners) || partners.length === 0) {
        el.innerText = "Chưa có đối tác nào.";
        return;
      }

      const html = partners
        .map((p) => {
          const img = p.imageUrl
            ? `<img src="${p.imageUrl}" alt="${p.name}" style="width:80px;height:80px;object-fit:cover;border-radius:9999px;" />`
            : "";
          return `
            <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;">
              ${img}
              <div>
                <div style="font-weight:600">${p.name}</div>
                <div style="font-size:14px;color:#555">${p.description || ""}</div>
              </div>
            </div>
          `;
        })
        .join("");

      el.innerHTML = html;
    } catch (e) {
      console.error("Partners block error", e);
      el.innerText = "Lỗi khi load danh sách đối tác.";
    }
  })();
</script>

{% schema %}
{
  "name": "Partners list (from app)",
  "target": "section",
  "settings": []
}
{% endschema %}
